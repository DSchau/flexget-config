variables: secrets.yml

schedules:
  # Run TV lookup task(s) every 30 minutes
  - tasks: 'series-*'
    schedule:
      minute: "*/30"
  # Run Movie lookup task(s) every hour
  - tasks: 'movies-*'
    schedule:
      minute: "*/60"
  # Run email task every night at 10:00 PM
  - tasks: [ daily-email ]
    schedule:
      hour: 22
      minute: 0

templates:
  global:
    content_filter:
      require:
        - '*.mkv'
        - '*.avi'
        - '*.mp4'
        - '*.mp3'
        - '*.aac'
    cookies: /home/dschau/.flexget/.cookies/cookies.sqlite
  torrent_server:
    transmission:
      port: 9091
      username: '{? user ?}'
      password: '{? password ?}'
      path: '/media/TVShows/{{ series_name }}/Season {{ series_season }}/'
  transmission_lookup:
    disable: builtins
    metainfo_series: yes
    thetvdb_lookup: yes
    imdb_lookup: yes
    tmdb_lookup: yes
    from_transmission:
      port: 9091
      username: '{? user ?}'
      password: '{? password ?}'
      only_complete: yes
  tv:
    template: [ torrent_server ]
    include: [ series.yml ]
    thetvdb_lookup: yes
  size_limit: 
    content_size:
      min: 150
      max: 4250
      strict: no

tasks:
  series__manual:
    thetvdb_lookup: yes
    csv:
      url: '{? csv.shows ?}'
      values:
        title: 1
        url: 1
        begin: 2
    accept_all: yes
    list_add:
      - entry_list: entries
    manual: yes

  series-btn:
    template: [ tv, size_limit ]
    priority: 1
    discover:
      what: 
        - next_series_episodes: yes
      from:
        - btn: '{? btn.apikey ?}'
      release_estimations: loose
    digest: daily email
    max_reruns: 3

  tv_manual:
    template: [ torrent_server ]
    accept_all: yes
    thetvdb_lookup: yes
    metainfo_series: yes
    disable: [ seen ]
    manual: yes

  movies-queue:
    priority: 1
    imdb_lookup: yes
    csv:
      url: '{? csv.movies ?}'
      values:
        title: 1
        url: 1
    accept_all: yes
    list_add:
      - movie_list: movie_queue
    manual: yes

  movies-ptp:
    priority: 2
    template: [ torrent_server ]
    set:
      path: '/media/Movies'
      add_paused: yes
    imdb_lookup: yes
    discover:
      what:
        - movie_list: movie_queue
      from:
        - passthepopcorn:
            username: '{? ptp.username ?}'
            password: '{? ptp.password ?}'
            passkey: '{? ptp.passkey ?}'
    quality:
      - 720p bluray
    digest: daily email
    list_match:
      from:
        - movie_list: movie_queue

  movies__manual:
    template: [ torrent_server ]
    set:
      path: '/media/Movies'
    accept_all: yes
    disable: [ seen ]
    manual: yes

  music_manual:
    template: [ torrent_server ]
    set:
      path: '/media/Music'
    accept_all: yes
    disable: [ seen ]
    manual: yes

  daily-email:
    interval: 1 days
    from_digest:
      list: daily email
      restore_state: yes
    disable: [ seen ]
    metainfo_series: yes
    thetvdb_lookup: yes
    imdb_lookup: yes
    tmdb_lookup: yes
    accept_all: yes
    notify:
      task:
        template: html-custom
        via:
          - email:
              from: '{? gmail.email ?}'
              to: '{? gmail.flexget ?}'
              smtp_host: smtp.gmail.com
              smtp_port: 587
              smtp_username: '{? gmail.username ?}'
              smtp_password: '{? gmail.password ?}'
              smtp_tls: yes
              html: yes
